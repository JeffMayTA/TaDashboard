<aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 " id="sidenav-main">
  <div class="sidenav-header">
    <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
    <a class="navbar-brand m-0" href="{{ url_for('index') }}">
      {{ logo|default('''<svg viewBox="0 0 143 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M141.61 -1.91155e-06H127C126.634 -1.91155e-06 126.283 0.145391 126.024 0.404191C125.765 0.662991 125.62 1.014 125.62 1.38V12.16C125.62 12.526 125.765 12.877 126.024 13.1358C126.283 13.3946 126.634 13.54 127 13.54H141.66C142.019 13.5296 142.36 13.3796 142.61 13.1219C142.86 12.8643 143 12.5192 143 12.16V1.38C143 1.19793 142.964 1.01766 142.894 0.849575C142.824 0.681491 142.721 0.528915 142.592 0.400638C142.463 0.272362 142.31 0.170921 142.141 0.10216C141.973 0.0333996 141.792 -0.00132125 141.61 -1.91155e-06ZM131 10.15C131 10.2065 130.989 10.2624 130.967 10.3146C130.946 10.3667 130.914 10.4141 130.874 10.4541C130.834 10.494 130.787 10.5257 130.735 10.5473C130.682 10.5689 130.626 10.58 130.57 10.58H129.42C129.306 10.58 129.197 10.5347 129.116 10.4541C129.035 10.3734 128.99 10.264 128.99 10.15V3.33C128.99 3.21596 129.035 3.10658 129.116 3.02594C129.197 2.9453 129.306 2.9 129.42 2.9H130.57C130.626 2.9 130.682 2.91112 130.735 2.93273C130.787 2.95434 130.834 2.98601 130.874 3.02594C130.914 3.06587 130.946 3.11327 130.967 3.16544C130.989 3.21761 131 3.27353 131 3.33V10.15ZM136.38 10.74C135.589 10.74 134.816 10.5054 134.158 10.0659C133.5 9.62635 132.987 9.00164 132.684 8.27073C132.382 7.53983 132.303 6.73556 132.457 5.95964C132.611 5.18371 132.992 4.47098 133.552 3.91157C134.111 3.35216 134.824 2.9712 135.6 2.81686C136.376 2.66252 137.18 2.74173 137.911 3.04448C138.642 3.34723 139.266 3.85992 139.706 4.51772C140.145 5.17551 140.38 5.94887 140.38 6.74C140.38 7.26867 140.275 7.7921 140.072 8.28003C139.868 8.76796 139.57 9.2107 139.194 9.58266C138.819 9.95462 138.373 10.2484 137.883 10.4471C137.393 10.6457 136.869 10.7453 136.34 10.74H136.38ZM138.38 6.74C138.38 7.13556 138.263 7.52224 138.043 7.85114C137.823 8.18004 137.511 8.43638 137.145 8.58776C136.78 8.73913 136.378 8.77874 135.99 8.70157C135.602 8.6244 135.245 8.43392 134.966 8.15421C134.686 7.87451 134.496 7.51814 134.418 7.13018C134.341 6.74222 134.381 6.34008 134.532 5.97463C134.684 5.60918 134.94 5.29682 135.269 5.07706C135.598 4.8573 135.984 4.74 136.38 4.74C136.645 4.73997 136.908 4.79268 137.152 4.89506C137.397 4.99744 137.619 5.14744 137.805 5.33635C137.991 5.52526 138.138 5.74929 138.236 5.99542C138.335 6.24154 138.384 6.50484 138.38 6.77V6.74Z" fill="currentColor"/><path d="M11.61 16.74V19.15C11.61 19.2587 11.5668 19.363 11.4899 19.4399C11.413 19.5168 11.3087 19.56 11.2 19.56H7.54V33.47C7.54002 33.5234 7.52935 33.5762 7.50863 33.6254C7.4879 33.6746 7.45754 33.7192 7.41933 33.7564C7.38112 33.7937 7.33584 33.823 7.28615 33.8425C7.23646 33.862 7.18337 33.8713 7.13 33.87H4.47C4.36392 33.87 4.26217 33.8279 4.18716 33.7528C4.11215 33.6778 4.07 33.5761 4.07 33.47V19.56H0.400003C0.346622 19.56 0.293778 19.5493 0.244584 19.5286C0.19539 19.5079 0.150842 19.4775 0.113565 19.4393C0.0762879 19.4011 0.0470357 19.3558 0.0275322 19.3061C0.00802867 19.2565 -0.00133157 19.2034 2.95862e-06 19.15V16.74C-2.88807e-05 16.633 0.0417921 16.5302 0.116532 16.4536C0.191273 16.377 0.293007 16.3326 0.400003 16.33H11.2C11.3087 16.33 11.413 16.3732 11.4899 16.4501C11.5668 16.527 11.61 16.6313 11.61 16.74ZM24.49 16.33H15.49C15.3813 16.33 15.277 16.3732 15.2001 16.4501C15.1232 16.527 15.08 16.6313 15.08 16.74V33.47C15.08 33.5234 15.0907 33.5762 15.1114 33.6254C15.1321 33.6746 15.1625 33.7192 15.2007 33.7564C15.2389 33.7937 15.2842 33.823 15.3339 33.8425C15.3835 33.862 15.4366 33.8713 15.49 33.87H24.49C24.5961 33.87 24.6978 33.8279 24.7728 33.7528C24.8479 33.6778 24.89 33.5761 24.89 33.47V31.08C24.89 30.9739 24.8479 30.8722 24.7728 30.7972C24.6978 30.7221 24.5961 30.68 24.49 30.68H18.49V26.19H22.7C22.8087 26.19 22.913 26.1468 22.9899 26.0699C23.0668 25.993 23.11 25.8887 23.11 25.78V23.52C23.11 23.4666 23.0994 23.4138 23.0786 23.3646C23.0579 23.3154 23.0275 23.2708 22.9893 23.2336C22.9511 23.1963 22.9058 23.167 22.8561 23.1475C22.8065 23.128 22.7534 23.1187 22.7 23.12H18.51V19.53H24.51C24.6161 19.53 24.7178 19.4879 24.7928 19.4128C24.8679 19.3378 24.91 19.2361 24.91 19.13V16.74C24.91 16.6853 24.8991 16.6312 24.8779 16.5808C24.8566 16.5304 24.8255 16.4847 24.7864 16.4465C24.7473 16.4083 24.7009 16.3783 24.65 16.3583C24.5991 16.3383 24.5447 16.3287 24.49 16.33ZM40.07 16.33H37.56C37.5066 16.33 37.4538 16.3407 37.4046 16.3614C37.3554 16.3821 37.3108 16.4125 37.2736 16.4507C37.2363 16.4889 37.207 16.5342 37.1875 16.5839C37.168 16.6335 37.1587 16.6866 37.16 16.74V26.32L36.28 24.68L31.61 16.54C31.5759 16.4768 31.5254 16.424 31.4638 16.387C31.4022 16.35 31.3318 16.3304 31.26 16.33H29.19C29.083 16.3326 28.9813 16.377 28.9065 16.4536C28.8318 16.5302 28.79 16.633 28.79 16.74V33.47C28.79 33.5761 28.8321 33.6778 28.9072 33.7528C28.9822 33.8279 29.0839 33.87 29.19 33.87H31.71C31.817 33.87 31.9198 33.8282 31.9964 33.7535C32.073 33.6787 32.1174 33.577 32.12 33.47V24L33.12 25.71L37.91 33.71C37.9481 33.7682 38 33.816 38.0611 33.8491C38.1221 33.8823 38.1905 33.8998 38.26 33.9H40.12C40.227 33.9 40.3298 33.8582 40.4064 33.7835C40.483 33.7087 40.5274 33.607 40.53 33.5V16.74C40.5289 16.6822 40.5158 16.6252 40.4917 16.5726C40.4675 16.52 40.4327 16.473 40.3895 16.4345C40.3463 16.3961 40.2957 16.3669 40.2407 16.3489C40.1857 16.3309 40.1276 16.3245 40.07 16.33ZM74.54 21.67V28.55C74.54 31.83 72.4 33.87 68.96 33.87H63.49C63.4366 33.8713 63.3835 33.862 63.3339 33.8425C63.2842 33.823 63.2389 33.7937 63.2007 33.7564C63.1625 33.7192 63.1321 33.6746 63.1114 33.6254C63.0907 33.5762 63.08 33.5234 63.08 33.47V16.74C63.08 16.6313 63.1232 16.527 63.2001 16.4501C63.277 16.3732 63.3813 16.33 63.49 16.33H69C72.4 16.33 74.54 18.38 74.54 21.67ZM66.54 30.67H68.72C69.0422 30.7148 69.3704 30.6834 69.6782 30.5783C69.9861 30.4732 70.265 30.2974 70.4926 30.065C70.7201 29.8325 70.89 29.55 70.9886 29.24C71.0871 28.93 71.1116 28.6012 71.06 28.28V21.94C71.06 20.32 70.3 19.53 68.72 19.53H66.55L66.54 30.67ZM89.68 33.35C89.6951 33.4099 89.6964 33.4723 89.684 33.5328C89.6715 33.5932 89.6456 33.6501 89.6081 33.6991C89.5706 33.7482 89.5225 33.7881 89.4674 33.8159C89.4124 33.8438 89.3517 33.8589 89.29 33.86H86.62C86.5309 33.8606 86.4441 33.8314 86.3734 33.7771C86.3028 33.7227 86.2523 33.6463 86.23 33.56L85.23 29.56H81.56L80.56 33.56C80.5361 33.6481 80.4841 33.7261 80.4119 33.782C80.3398 33.8379 80.2513 33.8688 80.16 33.87H77.6C77.5376 33.8717 77.4758 33.8579 77.42 33.83C77.3642 33.8021 77.3161 33.7609 77.28 33.71C77.2413 33.6614 77.2148 33.6044 77.2026 33.5435C77.1904 33.4826 77.193 33.4197 77.21 33.36L81.62 16.64C81.6453 16.5527 81.6977 16.4756 81.7696 16.4199C81.8414 16.3642 81.9291 16.3327 82.02 16.33H84.83C84.9205 16.3299 85.0083 16.3606 85.0792 16.4169C85.15 16.4732 85.1996 16.5518 85.22 16.64L89.68 33.35ZM83.36 22L82.06 27.21H84.7L83.36 22ZM60.36 33.35C60.377 33.4097 60.3796 33.4726 60.3674 33.5335C60.3552 33.5944 60.3287 33.6514 60.29 33.7C60.2552 33.7523 60.2074 33.7945 60.1513 33.8226C60.0952 33.8506 60.0327 33.8635 59.97 33.86H57.31C57.2213 33.8589 57.1353 33.8291 57.065 33.775C56.9947 33.7209 56.9438 33.6455 56.92 33.56L55.92 29.56H52.26L51.26 33.56C51.2396 33.6482 51.19 33.7268 51.1192 33.7831C51.0483 33.8394 50.9605 33.8701 50.87 33.87H48.3C48.2383 33.8689 48.1776 33.8538 48.1226 33.8259C48.0675 33.7981 48.0194 33.7582 47.9819 33.7091C47.9444 33.6601 47.9185 33.6032 47.906 33.5428C47.8936 33.4823 47.8949 33.4199 47.91 33.36L52.32 16.64C52.3439 16.5519 52.3959 16.4739 52.4681 16.418C52.5402 16.3621 52.6287 16.3312 52.72 16.33H55.53C55.62 16.3317 55.707 16.3629 55.7775 16.419C55.848 16.475 55.8981 16.5527 55.92 16.64L60.36 33.35ZM54.05 22L52.76 27.21H55.4L54.05 22ZM107.71 16.32H104C103.907 16.3218 103.818 16.3541 103.746 16.412C103.673 16.4698 103.622 16.55 103.6 16.64L101 27.12L100.59 28.84L97.5 16.64C97.4761 16.5519 97.4241 16.4739 97.3519 16.418C97.2797 16.3621 97.1913 16.3312 97.1 16.33H93.39C93.283 16.3326 93.1813 16.377 93.1065 16.4536C93.0318 16.5302 92.99 16.633 92.99 16.74V33.47C92.99 33.5761 93.0321 33.6778 93.1072 33.7528C93.1822 33.8279 93.2839 33.87 93.39 33.87H95.78C95.8861 33.87 95.9878 33.8279 96.0628 33.7528C96.1379 33.6778 96.18 33.5761 96.18 33.47V23.55L98.8 33.55C98.8238 33.6355 98.8747 33.7109 98.945 33.765C99.0153 33.8191 99.1013 33.8489 99.19 33.85H101.83C101.919 33.8506 102.006 33.8214 102.077 33.7671C102.147 33.7127 102.198 33.6363 102.22 33.55L104.89 23.65V23.53V33.45C104.893 33.557 104.937 33.6587 105.014 33.7335C105.09 33.8082 105.193 33.85 105.3 33.85H107.69C107.796 33.85 107.898 33.8079 107.973 33.7328C108.048 33.6578 108.09 33.5561 108.09 33.45V16.74C108.09 16.6363 108.051 16.5363 107.981 16.4602C107.91 16.3841 107.813 16.3376 107.71 16.33V16.32ZM119.1 23.6C116.2 22.2 115.76 21.69 115.76 20.65C115.76 19.61 116.45 18.97 117.64 18.97C117.965 18.9368 118.294 18.9777 118.601 19.0898C118.908 19.2019 119.185 19.3822 119.412 19.6171C119.64 19.852 119.81 20.1354 119.912 20.446C120.014 20.7566 120.044 21.0862 120 21.41V21.69C119.999 21.7434 120.008 21.7965 120.028 21.8461C120.047 21.8958 120.076 21.9411 120.114 21.9793C120.151 22.0175 120.195 22.0479 120.245 22.0686C120.294 22.0894 120.347 22.1 120.4 22.1H122.96C123.069 22.1 123.173 22.0568 123.25 21.9799C123.327 21.903 123.37 21.7987 123.37 21.69V21C123.37 18 121.07 15.9 117.77 15.9C114.47 15.9 112.34 17.9 112.34 20.9C112.34 23.9 114.61 25.16 117.07 26.29C119.53 27.42 120.07 28.11 120.07 29.21C120.089 29.4907 120.045 29.7722 119.942 30.0339C119.838 30.2955 119.678 30.5308 119.472 30.7224C119.266 30.9141 119.019 31.0573 118.751 31.1417C118.483 31.226 118.199 31.2494 117.92 31.21C116.34 31.21 115.61 30.4 115.61 28.65V28.37C115.61 28.3166 115.599 28.2638 115.579 28.2146C115.558 28.1654 115.528 28.1208 115.489 28.0836C115.451 28.0463 115.406 28.017 115.356 27.9975C115.306 27.978 115.253 27.9687 115.2 27.97H112.57C112.517 27.9687 112.464 27.978 112.414 27.9975C112.364 28.017 112.319 28.0463 112.281 28.0836C112.242 28.1208 112.212 28.1654 112.191 28.2146C112.171 28.2638 112.16 28.3166 112.16 28.37V29.18C112.16 32.18 114.55 34.28 117.84 34.28C121.13 34.28 123.57 32.02 123.57 28.9C123.47 26.23 121.87 24.94 119.1 23.61V23.6Z" fill="currentColor"/></svg>''')|safe }}
    </a>
  </div>
  <div class="collapse navbar-collapse  w-auto h-auto" id="sidenav-collapse-main">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="{{ url_for('index') }}">
          <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center  me-2 d-flex align-items-center justify-content-center text-dark fas fa-gauge-high"></div>
          <span class="nav-link-text ms-1">Welcome</span>
        </a>
      </li>
      <!-- Check if the user is associated with any clients -->
      {% if current_user.clients %}
      {% set rendered_menu_items = {} %} {# Create a dictionary to store rendered menu_item IDs #}
        {% for role in current_user.roles %}
          {% for menu_item in role.menu_items %}
            {% if current_user.clients and (menu_item.client_id is none or menu_item.client_id in current_user.clients|map(attribute='id')) %}
              {% if menu_item.parent_menu_item_id is none %}
                {% if menu_item.id not in rendered_menu_items %} {# Check if the menu_item has not been rendered for any role #}
                  {% set _ = rendered_menu_items.update({menu_item.id: true}) %} {# Mark the menu_item ID as rendered #}
                  <li class="nav-item">
                    <hr class="horizontal dark" />
                    <a data-bs-toggle="collapse" href="#nav{{ role.id }}{{ menu_item.id }}" class="nav-link" aria-controls="nav{{ role.id }}{{ menu_item.id }}" role="button" aria-expanded="true">
                      <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center d-flex align-items-center justify-content-center fas {{ menu_item.icon_class }} text-dark me-2">
                      </div>
                      <span class="nav-link-text ms-1">{{ menu_item.label }}</span>
                    </a>
                    <div class="collapse show" id="nav{{ role.id }}{{ menu_item.id }}">
                      <ul class="nav ms-4 ps-3">
                        {% for sub_item in role.menu_items %}
                          {% if sub_item.parent_menu_item_id == menu_item.id and (sub_item.client_id is none or sub_item.client_id in current_user.clients|map(attribute='id')) %}
                            {% if sub_item.id not in rendered_menu_items %} {# Check if the sub_item has not been rendered for any role #}
                              {% set _ = rendered_menu_items.update({sub_item.id: true}) %} {# Mark the sub_item ID as rendered #}
                              <li class="nav-item">
                                <a class="nav-link" href="{{ url_for(sub_item.target_url) }}">
                                  <!-- Render the sub-menu item icon and label as a link -->
                                  <span>{{ sub_item.label }}</span>
                                </a>
                              </li>
                            {% endif %}
                          {% endif %}
                        {% endfor %}
                      </ul>
                    </div>
                  </li>
                {% endif %}
              {% endif %}
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% endif %}
      
      <li class="nav-item">
        <hr class="horizontal dark" />
        <form action="{{ url_for('auth.logout') }}" method="POST">
          <button type="submit" class="nav-link btn btn-link">
            <div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center me-2 d-flex align-items-center justify-content-center text-dark fas fa-right-from-bracket"></div>
            <span class="nav-link-text ms-1">Logout</span>
          </button>
        </form>
      </li>
    </ul>
  </div>
  <div class="sidenav-footer mx-3 mt-3 pt-3">
    <div class="card card-background shadow-none card-background-mask-secondary" id="sidenavCard">
      <div class="full-background" style="background-image: url('{{ url_for('static', filename='assets/img/curved-images/white-curved.jpg') }}')"></div>
      <div class="card-body text-start p-3 w-100">
        <div class="logomark mb-4">
          <svg width="49" height="36" viewBox="0 0 49 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M45.0811 9.63422e-05H3.89067C2.8588 9.63422e-05 1.86922 0.386664 1.13901 1.07476C0.408801 1.76285 0 2.69611 0 3.66922V32.3309C0 33.304 0.408801 34.2372 1.13901 34.9253C1.86922 35.6134 2.8588 36 3.89067 36H45.2221C46.2342 35.9723 47.1956 35.5735 47.9005 34.8884C48.6053 34.2035 49 33.2859 49 32.3309V3.66922C49 3.18514 48.8985 2.70584 48.7011 2.25894C48.5038 1.81204 48.2134 1.40637 47.8497 1.06531C47.486 0.724252 47.0547 0.454543 46.5782 0.271723C46.1046 0.0889036 45.5942 -0.00341149 45.0811 9.63422e-05ZM15.168 26.9867C15.168 27.137 15.137 27.2856 15.075 27.4244C15.0157 27.5629 14.9255 27.6889 14.8127 27.7953C14.7 27.9014 14.5675 27.9856 14.4209 28.0431C14.2715 28.1005 14.1136 28.13 13.9557 28.13H10.7135C10.392 28.13 10.0847 28.0096 9.85637 27.7953C9.62801 27.5807 9.50116 27.2898 9.50116 26.9867V8.85384C9.50116 8.55064 9.62801 8.25982 9.85637 8.04541C10.0847 7.83101 10.392 7.71057 10.7135 7.71057H13.9557C14.1136 7.71057 14.2715 7.74013 14.4209 7.79759C14.5675 7.85505 14.7 7.93925 14.8127 8.04541C14.9255 8.15158 15.0157 8.27761 15.075 8.41631C15.137 8.55502 15.168 8.7037 15.168 8.85384V26.9867ZM30.336 28.5554C28.1059 28.5554 25.9266 27.9317 24.0715 26.7631C22.2164 25.5945 20.77 23.9335 19.9158 21.9902C19.0643 20.0469 18.8416 17.9085 19.2758 15.8455C19.71 13.7825 20.7841 11.8875 22.3629 10.4001C23.939 8.91276 25.9492 7.89987 28.137 7.48952C30.3248 7.07916 32.5915 7.28976 34.6524 8.09471C36.7133 8.89965 38.4726 10.2628 39.7131 12.0117C40.9508 13.7607 41.6134 15.8168 41.6134 17.9203C41.6134 19.3259 41.3173 20.7176 40.745 22.0149C40.1699 23.3122 39.3297 24.4893 38.2696 25.4783C37.2124 26.4673 35.9549 27.2484 34.5735 27.7767C33.192 28.3047 31.7147 28.5695 30.2232 28.5554H30.336ZM35.9747 17.9203C35.9747 18.972 35.6448 20.0001 35.0246 20.8746C34.4043 21.749 33.5247 22.4306 32.4928 22.8331C31.4638 23.2355 30.3304 23.3408 29.2365 23.1357C28.1426 22.9305 27.1361 22.4241 26.3495 21.6804C25.5601 20.9367 25.0244 19.9892 24.8045 18.9577C24.5874 17.9262 24.7002 16.857 25.1259 15.8853C25.5544 14.9137 26.2762 14.0832 27.2037 13.4989C28.1313 12.9146 29.2196 12.6027 30.336 12.6027C31.0832 12.6026 31.8246 12.7428 32.5125 13.015C33.2033 13.2872 33.8291 13.686 34.3535 14.1883C34.8779 14.6906 35.2924 15.2862 35.5687 15.9406C35.8478 16.595 35.986 17.295 35.9747 18.0001V17.9203Z" fill="white"/></svg>
        </div>
        <div class="docs-info">
          <h6 class="text-white up mb-2">Ask Us Anything</h6>
          <a href="#" target="_blank" class="btn btn-white btn-sm w-100 mb-0">Contact Us</a>
        </div>
      </div>
    </div>
  </div>
</aside>